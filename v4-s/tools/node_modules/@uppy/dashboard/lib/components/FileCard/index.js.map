{"version":3,"sources":["index.js"],"names":["require","h","Component","classNames","getFileTypeIcon","ignoreEvent","FilePreview","FileCard","props","saveOnEnter","ev","keyCode","stopPropagation","preventDefault","file","files","fileCardFor","saveFileCard","state","formState","id","updateMeta","newVal","name","setState","handleSave","fileID","handleCancel","toggleFileCard","renderMetaFields","metaFields","fieldCSSClasses","text","map","field","render","undefined","value","onChange","type","placeholder","target","storedMetaData","forEach","meta","showEditButton","canEditFile","className","i18nArray","i18n","backgroundColor","color","openFileEditor","module","exports"],"mappings":"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","sourcesContent":["const { h, Component } = require('preact')\nconst classNames = require('classnames')\nconst getFileTypeIcon = require('../../utils/getFileTypeIcon')\nconst ignoreEvent = require('../../utils/ignoreEvent.js')\nconst FilePreview = require('../FilePreview')\n\nclass FileCard extends Component {\n  constructor (props) {\n    super(props)\n\n    const file = this.props.files[this.props.fileCardFor]\n    const metaFields = this.props.metaFields || []\n\n    const storedMetaData = {}\n    metaFields.forEach((field) => {\n      storedMetaData[field.id] = file.meta[field.id] || ''\n    })\n\n    this.state = {\n      formState: storedMetaData\n    }\n  }\n\n  saveOnEnter = (ev) => {\n    if (ev.keyCode === 13) {\n      ev.stopPropagation()\n      ev.preventDefault()\n      const file = this.props.files[this.props.fileCardFor]\n      this.props.saveFileCard(this.state.formState, file.id)\n    }\n  }\n\n  updateMeta = (newVal, name) => {\n    this.setState({\n      formState: {\n        ...this.state.formState,\n        [name]: newVal\n      }\n    })\n  }\n\n  handleSave = () => {\n    const fileID = this.props.fileCardFor\n    this.props.saveFileCard(this.state.formState, fileID)\n  }\n\n  handleCancel = () => {\n    this.props.toggleFileCard(false)\n  }\n\n  renderMetaFields = () => {\n    const metaFields = this.props.metaFields || []\n    const fieldCSSClasses = {\n      text: 'uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input'\n    }\n\n    return metaFields.map((field) => {\n      const id = `uppy-Dashboard-FileCard-input-${field.id}`\n      return (\n        <fieldset key={field.id} class=\"uppy-Dashboard-FileCard-fieldset\">\n          <label class=\"uppy-Dashboard-FileCard-label\" for={id}>{field.name}</label>\n          {field.render !== undefined\n            ? field.render({\n              value: this.state.formState[field.id],\n              onChange: (newVal) => this.updateMeta(newVal, field.id),\n              fieldCSSClasses: fieldCSSClasses\n            }, h)\n            : (\n              <input\n                class={fieldCSSClasses.text}\n                id={id}\n                type={field.type || 'text'}\n                value={this.state.formState[field.id]}\n                placeholder={field.placeholder}\n                onkeyup={this.saveOnEnter}\n                onkeydown={this.saveOnEnter}\n                onkeypress={this.saveOnEnter}\n                oninput={ev => this.updateMeta(ev.target.value, field.id)}\n                data-uppy-super-focusable\n              />\n            )}\n        </fieldset>\n      )\n    })\n  }\n\n  render () {\n    const file = this.props.files[this.props.fileCardFor]\n    const showEditButton = this.props.canEditFile(file)\n\n    return (\n      <div\n        class={classNames('uppy-Dashboard-FileCard', this.props.className)}\n        data-uppy-panelType=\"FileCard\"\n        onDragOver={ignoreEvent}\n        onDragLeave={ignoreEvent}\n        onDrop={ignoreEvent}\n        onPaste={ignoreEvent}\n      >\n        <div class=\"uppy-DashboardContent-bar\">\n          <div class=\"uppy-DashboardContent-title\" role=\"heading\" aria-level=\"1\">\n            {this.props.i18nArray('editing', {\n              file: <span class=\"uppy-DashboardContent-titleFile\">{file.meta ? file.meta.name : file.name}</span>\n            })}\n          </div>\n          <button\n            class=\"uppy-DashboardContent-back\" type=\"button\" title={this.props.i18n('finishEditingFile')}\n            onclick={this.handleSave}\n          >\n            {this.props.i18n('done')}\n          </button>\n        </div>\n\n        <div class=\"uppy-Dashboard-FileCard-inner\">\n          <div class=\"uppy-Dashboard-FileCard-preview\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\n            <FilePreview file={file} />\n            {showEditButton &&\n              <button\n                type=\"button\"\n                class=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\n                onClick={() => this.props.openFileEditor(file)}\n              >\n                {this.props.i18n('editFile')}\n              </button>}\n          </div>\n\n          <div class=\"uppy-Dashboard-FileCard-info\">\n            {this.renderMetaFields()}\n          </div>\n\n          <div class=\"uppy-Dashboard-FileCard-actions\">\n            <button\n              class=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\n              type=\"button\"\n              onclick={this.handleSave}\n            >\n              {this.props.i18n('saveChanges')}\n            </button>\n            <button\n              class=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\n              type=\"button\"\n              onclick={this.handleCancel}\n            >\n              {this.props.i18n('cancel')}\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nmodule.exports = FileCard\n"]}