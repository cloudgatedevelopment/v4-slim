{"version":3,"sources":["index.js"],"names":["require","h","Plugin","Translator","getFileTypeExtension","mimeTypes","canvasToBlob","supportsMediaRecorder","CameraIcon","CameraScreen","PermissionsScreen","toMimeType","fileType","slice","isVideoMimeType","mimeType","test","isImageMimeType","getMediaDevices","navigator","mediaDevices","getUserMedia","mozGetUserMedia","webkitGetUserMedia","opts","Promise","resolve","reject","call","module","exports","uppy","supportsUserMedia","protocol","location","match","id","title","type","icon","defaultLocale","strings","smile","takePicture","startRecording","stopRecording","allowAccessTitle","allowAccessDescription","noCameraTitle","noCameraDescription","recordingStoppedMaxSize","recordingLength","defaultOptions","onBeforeSnapshot","countdown","modes","mirror","showVideoSourceDropdown","facingMode","preferredImageMimeType","preferredVideoMimeType","showRecordingLength","i18nInit","install","bind","setPluginState","render","_start","_stop","_takeSnapshot","_startRecording","_stopRecording","_oneTwoThreeSmile","_focus","_changeVideoSource","webcamActive","hasCamera","cameraReady","cameraError","recordingLengthSeconds","videoSources","currentDeviceId","setOptions","newOpts","videoConstraints","translator","locale","i18n","translate","i18nArray","translateArray","hasCameraCheck","enumerateDevices","then","devices","some","device","kind","getConstraints","deviceId","acceptsAudio","indexOf","acceptsVideo","audio","video","options","Error","constraints","stream","getVideoTracks","getSettings","forEach","videoTrack","updateVideoSources","catch","err","info","message","_getMediaRecorderOptions","MediaRecorder","isTypeSupported","restrictions","preferredVideoMimeTypes","allowedFileTypes","map","filter","acceptableMimeTypes","candidateType","length","recorder","recordingChunks","stoppingBecauseOfMaxSize","addEventListener","event","push","data","maxFileSize","totalSize","reduce","acc","chunk","size","averageChunkSize","expectedEndChunkSize","maxSize","Math","max","start","recordingLengthTimer","setInterval","currentRecordingLength","getPluginState","isRecording","stopped","stop","clearInterval","getVideo","file","addFile","isRestriction","log","error","getAudioTracks","track","_getVideoElement","el","querySelector","count","countDown","captureInProgress","setTimeout","_getImage","tagFile","width","videoWidth","height","videoHeight","canvas","document","createElement","ctx","getContext","drawImage","preferredImageMimeTypes","ext","name","Date","now","blob","source","Blob","fileExtension","webcamState","target","mount","ondevicechange","restartStream","videoSource","uninstall","unmount","VERSION"],"mappings":";;;;;;;;eAAcA,OAAO,CAAC,QAAD,C;IAAbC,C,YAAAA,C;;gBACWD,OAAO,CAAC,YAAD,C;IAAlBE,M,aAAAA,M;;AACR,IAAMC,UAAU,GAAGH,OAAO,CAAC,4BAAD,CAA1B;;AACA,IAAMI,oBAAoB,GAAGJ,OAAO,CAAC,sCAAD,CAApC;;AACA,IAAMK,SAAS,GAAGL,OAAO,CAAC,2BAAD,CAAzB;;AACA,IAAMM,YAAY,GAAGN,OAAO,CAAC,8BAAD,CAA5B;;AACA,IAAMO,qBAAqB,GAAGP,OAAO,CAAC,yBAAD,CAArC;;AACA,IAAMQ,UAAU,GAAGR,OAAO,CAAC,cAAD,CAA1B;;AACA,IAAMS,YAAY,GAAGT,OAAO,CAAC,gBAAD,CAA5B;;AACA,IAAMU,iBAAiB,GAAGV,OAAO,CAAC,qBAAD,CAAjC;AAEA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASW,UAAT,CAAqBC,QAArB,EAA+B;AAC7B,MAAIA,QAAQ,CAAC,CAAD,CAAR,KAAgB,GAApB,EAAyB;AACvB,WAAOP,SAAS,CAACO,QAAQ,CAACC,KAAT,CAAe,CAAf,CAAD,CAAhB;AACD;;AACD,SAAOD,QAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASE,eAAT,CAA0BC,QAA1B,EAAoC;AAClC,SAAO,iBAAiBC,IAAjB,CAAsBD,QAAtB,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASE,eAAT,CAA0BF,QAA1B,EAAoC;AAClC,SAAO,iBAAiBC,IAAjB,CAAsBD,QAAtB,CAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASG,eAAT,GAA4B;AAC1B;AACA,MAAIC,SAAS,CAACC,YAAV,IAA0BD,SAAS,CAACC,YAAV,CAAuBC,YAArD,EAAmE;AACjE;AACA,WAAOF,SAAS,CAACC,YAAjB;AACD;;AAED,MAAMC,aAAY,GAAGF,SAAS,CAACG,eAAV,IAA6BH,SAAS,CAACI,kBAA5D;;AACA,MAAI,CAACF,aAAL,EAAmB;AACjB,WAAO,IAAP;AACD;;AAED,SAAO;AACLA,IAAAA,YADK,wBACSG,IADT,EACe;AAClB,aAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCN,QAAAA,aAAY,CAACO,IAAb,CAAkBT,SAAlB,EAA6BK,IAA7B,EAAmCE,OAAnC,EAA4CC,MAA5C;AACD,OAFM,CAAP;AAGD;AALI,GAAP;AAOD;AACD;AACA;AACA;;;AACAE,MAAM,CAACC,OAAP;AAAA;;AAGE,kBAAaC,IAAb,EAAmBP,IAAnB,EAAyB;AAAA;;AACvB,+BAAMO,IAAN,EAAYP,IAAZ;AACA,UAAKJ,YAAL,GAAoBF,eAAe,EAAnC;AACA,UAAKc,iBAAL,GAAyB,CAAC,CAAC,MAAKZ,YAAhC;AACA,UAAKa,QAAL,GAAgBC,QAAQ,CAACD,QAAT,CAAkBE,KAAlB,CAAwB,QAAxB,IAAoC,OAApC,GAA8C,MAA9D;AACA,UAAKC,EAAL,GAAU,MAAKZ,IAAL,CAAUY,EAAV,IAAgB,QAA1B;AACA,UAAKC,KAAL,GAAa,MAAKb,IAAL,CAAUa,KAAV,IAAmB,QAAhC;AACA,UAAKC,IAAL,GAAY,UAAZ;;AACA,UAAKC,IAAL,GAAY;AAAA,aACV;AAAK,uBAAY,MAAjB;AAAwB,QAAA,SAAS,EAAC,OAAlC;AAA0C,QAAA,KAAK,EAAC,IAAhD;AAAqD,QAAA,MAAM,EAAC,IAA5D;AAAiE,QAAA,OAAO,EAAC;AAAzE,SACE;AAAG,QAAA,IAAI,EAAC,MAAR;AAAe,qBAAU;AAAzB,SACE;AAAM,QAAA,IAAI,EAAC,SAAX;AAAqB,QAAA,KAAK,EAAC,IAA3B;AAAgC,QAAA,MAAM,EAAC,IAAvC;AAA4C,QAAA,EAAE,EAAC;AAA/C,QADF,EAEE;AAAM,QAAA,CAAC,EAAC,wZAAR;AAAia,QAAA,IAAI,EAAC,MAAta;AAA6a,qBAAU;AAAvb,QAFF,CADF,CADU;AAAA,KAAZ;;AASA,UAAKC,aAAL,GAAqB;AACnBC,MAAAA,OAAO,EAAE;AACPC,QAAAA,KAAK,EAAE,QADA;AAEPC,QAAAA,WAAW,EAAE,gBAFN;AAGPC,QAAAA,cAAc,EAAE,uBAHT;AAIPC,QAAAA,aAAa,EAAE,sBAJR;AAKPC,QAAAA,gBAAgB,EAAE,oCALX;AAMPC,QAAAA,sBAAsB,EAAE,uGANjB;AAOPC,QAAAA,aAAa,EAAE,sBAPR;AAQPC,QAAAA,mBAAmB,EAAE,2EARd;AASPC,QAAAA,uBAAuB,EAAE,sEATlB;AAUPC,QAAAA,eAAe,EAAE;AAVV;AADU,KAArB,CAjBuB,CAgCvB;;AACA,QAAMC,cAAc,GAAG;AACrBC,MAAAA,gBAAgB,EAAE;AAAA,eAAM5B,OAAO,CAACC,OAAR,EAAN;AAAA,OADG;AAErB4B,MAAAA,SAAS,EAAE,KAFU;AAGrBC,MAAAA,KAAK,EAAE,CACL,aADK,EAEL,YAFK,EAGL,YAHK,EAIL,SAJK,CAHc;AASrBC,MAAAA,MAAM,EAAE,IATa;AAUrBC,MAAAA,uBAAuB,EAAE,KAVJ;AAWrBC,MAAAA,UAAU,EAAE,MAXS;AAYrBC,MAAAA,sBAAsB,EAAE,IAZH;AAarBC,MAAAA,sBAAsB,EAAE,IAbH;AAcrBC,MAAAA,mBAAmB,EAAE;AAdA,KAAvB;AAiBA,UAAKrC,IAAL,gBAAiB4B,cAAjB,EAAoC5B,IAApC;;AAEA,UAAKsC,QAAL;;AAEA,UAAKC,OAAL,GAAe,MAAKA,OAAL,CAAaC,IAAb,+BAAf;AACA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBD,IAApB,+BAAtB;AAEA,UAAKE,MAAL,GAAc,MAAKA,MAAL,CAAYF,IAAZ,+BAAd,CAzDuB,CA2DvB;;AACA,UAAKG,MAAL,GAAc,MAAKA,MAAL,CAAYH,IAAZ,+BAAd;AACA,UAAKI,KAAL,GAAa,MAAKA,KAAL,CAAWJ,IAAX,+BAAb;AACA,UAAKK,aAAL,GAAqB,MAAKA,aAAL,CAAmBL,IAAnB,+BAArB;AACA,UAAKM,eAAL,GAAuB,MAAKA,eAAL,CAAqBN,IAArB,+BAAvB;AACA,UAAKO,cAAL,GAAsB,MAAKA,cAAL,CAAoBP,IAApB,+BAAtB;AACA,UAAKQ,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBR,IAAvB,+BAAzB;AACA,UAAKS,MAAL,GAAc,MAAKA,MAAL,CAAYT,IAAZ,+BAAd;AACA,UAAKU,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBV,IAAxB,+BAA1B;AAEA,UAAKW,YAAL,GAAoB,KAApB;;AAEA,QAAI,MAAKnD,IAAL,CAAU8B,SAAd,EAAyB;AACvB,YAAK9B,IAAL,CAAU6B,gBAAV,GAA6B,MAAKmB,iBAAlC;AACD;;AAED,UAAKP,cAAL,CAAoB;AAClBW,MAAAA,SAAS,EAAE,KADO;AAElBC,MAAAA,WAAW,EAAE,KAFK;AAGlBC,MAAAA,WAAW,EAAE,IAHK;AAIlBC,MAAAA,sBAAsB,EAAE,CAJN;AAKlBC,MAAAA,YAAY,EAAE,EALI;AAMlBC,MAAAA,eAAe,EAAE;AANC,KAApB;;AA3EuB;AAmFxB;;AAtFH;;AAAA,SAwFEC,UAxFF,GAwFE,oBAAYC,OAAZ,EAAqB;AACnB,sBAAMD,UAAN,yBACKC,OADL;AAEEC,MAAAA,gBAAgB,eAEX,KAAK5D,IAAL,CAAU4D,gBAFC,EAGXD,OAHW,oBAGXA,OAAO,CAAEC,gBAHE;AAFlB;;AASA,SAAKtB,QAAL;AACD,GAnGH;;AAAA,SAqGEA,QArGF,GAqGE,oBAAY;AACV,SAAKuB,UAAL,GAAkB,IAAIlF,UAAJ,CAAe,CAAC,KAAKqC,aAAN,EAAqB,KAAKT,IAAL,CAAUuD,MAA/B,EAAuC,KAAK9D,IAAL,CAAU8D,MAAjD,CAAf,CAAlB;AACA,SAAKC,IAAL,GAAY,KAAKF,UAAL,CAAgBG,SAAhB,CAA0BxB,IAA1B,CAA+B,KAAKqB,UAApC,CAAZ;AACA,SAAKI,SAAL,GAAiB,KAAKJ,UAAL,CAAgBK,cAAhB,CAA+B1B,IAA/B,CAAoC,KAAKqB,UAAzC,CAAjB;AACA,SAAKpB,cAAL,GAJU,CAIY;AACvB,GA1GH;;AAAA,SA4GE0B,cA5GF,GA4GE,0BAAkB;AAChB,QAAI,CAAC,KAAKvE,YAAV,EAAwB;AACtB,aAAOK,OAAO,CAACC,OAAR,CAAgB,KAAhB,CAAP;AACD;;AAED,WAAO,KAAKN,YAAL,CAAkBwE,gBAAlB,GAAqCC,IAArC,CAA0C,UAAAC,OAAO,EAAI;AAC1D,aAAOA,OAAO,CAACC,IAAR,CAAa,UAAAC,MAAM;AAAA,eAAIA,MAAM,CAACC,IAAP,KAAgB,YAApB;AAAA,OAAnB,CAAP;AACD,KAFM,CAAP;AAGD,GApHH;;AAAA,SAsHEC,cAtHF,GAsHE,wBAAgBC,QAAhB,EAAiC;AAAA;;AAAA,QAAjBA,QAAiB;AAAjBA,MAAAA,QAAiB,GAAN,IAAM;AAAA;;AAC/B,QAAMC,YAAY,GAAG,KAAK5E,IAAL,CAAU+B,KAAV,CAAgB8C,OAAhB,CAAwB,aAAxB,MAA2C,CAAC,CAA5C,IACnB,KAAK7E,IAAL,CAAU+B,KAAV,CAAgB8C,OAAhB,CAAwB,YAAxB,MAA0C,CAAC,CAD7C;AAEA,QAAMC,YAAY,GAAG,KAAK9E,IAAL,CAAU+B,KAAV,CAAgB8C,OAAhB,CAAwB,aAAxB,MAA2C,CAAC,CAA5C,IACnB,KAAK7E,IAAL,CAAU+B,KAAV,CAAgB8C,OAAhB,CAAwB,YAAxB,MAA0C,CAAC,CADxB,IAEnB,KAAK7E,IAAL,CAAU+B,KAAV,CAAgB8C,OAAhB,CAAwB,SAAxB,MAAuC,CAAC,CAF1C;;AAIA,QAAMjB,gBAAgB,yCAChB,KAAK5D,IAAL,CAAU4D,gBADM,oCACc;AAAE1B,MAAAA,UAAU,EAAE,KAAKlC,IAAL,CAAUkC;AAAxB,KADd,EAIhByC,QAAQ,GAAG;AAAEA,MAAAA,QAAQ,EAARA,QAAF;AAAYzC,MAAAA,UAAU,EAAE;AAAxB,KAAH,GAAoC,EAJ5B,CAAtB;;AAOA,WAAO;AACL6C,MAAAA,KAAK,EAAEH,YADF;AAELI,MAAAA,KAAK,EAAEF,YAAY,GAAGlB,gBAAH,GAAsB;AAFpC,KAAP;AAID,GAxIH;;AAAA,SA0IEjB,MA1IF,GA0IE,gBAAQsC,OAAR,EAAwB;AAAA;;AAAA,QAAhBA,OAAgB;AAAhBA,MAAAA,OAAgB,GAAN,IAAM;AAAA;;AACtB,QAAI,CAAC,KAAKzE,iBAAV,EAA6B;AAC3B,aAAOP,OAAO,CAACE,MAAR,CAAe,IAAI+E,KAAJ,CAAU,6BAAV,CAAf,CAAP;AACD;;AAED,SAAK/B,YAAL,GAAoB,IAApB;AAEA,QAAMgC,WAAW,GAAG,KAAKT,cAAL,CAAoBO,OAAO,IAAIA,OAAO,CAACN,QAAnB,GAA8BM,OAAO,CAACN,QAAtC,GAAiD,IAArE,CAApB;AAEA,SAAKR,cAAL,GAAsBE,IAAtB,CAA2B,UAAAjB,SAAS,EAAI;AACtC,MAAA,MAAI,CAACX,cAAL,CAAoB;AAClBW,QAAAA,SAAS,EAAEA;AADO,OAApB,EADsC,CAKtC;;;AACA,aAAO,MAAI,CAACxD,YAAL,CAAkBC,YAAlB,CAA+BsF,WAA/B,EACJd,IADI,CACC,UAACe,MAAD,EAAY;AAChB,QAAA,MAAI,CAACA,MAAL,GAAcA,MAAd;AAEA,YAAI3B,eAAe,GAAG,IAAtB;;AACA,YAAI,CAACwB,OAAD,IAAY,CAACA,OAAO,CAACN,QAAzB,EAAmC;AACjClB,UAAAA,eAAe,GAAG2B,MAAM,CAACC,cAAP,GAAwB,CAAxB,EAA2BC,WAA3B,GAAyCX,QAA3D;AACD,SAFD,MAEO;AACLS,UAAAA,MAAM,CAACC,cAAP,GAAwBE,OAAxB,CAAgC,UAACC,UAAD,EAAgB;AAC9C,gBAAIA,UAAU,CAACF,WAAX,GAAyBX,QAAzB,KAAsCM,OAAO,CAACN,QAAlD,EAA4D;AAC1DlB,cAAAA,eAAe,GAAG+B,UAAU,CAACF,WAAX,GAAyBX,QAA3C;AACD;AACF,WAJD;AAKD,SAZe,CAchB;;;AACA,QAAA,MAAI,CAACc,kBAAL;;AAEA,QAAA,MAAI,CAAChD,cAAL,CAAoB;AAClBgB,UAAAA,eAAe,EAAfA,eADkB;AAElBJ,UAAAA,WAAW,EAAE;AAFK,SAApB;AAID,OAtBI,EAuBJqC,KAvBI,CAuBE,UAACC,GAAD,EAAS;AACd,QAAA,MAAI,CAAClD,cAAL,CAAoB;AAClBY,UAAAA,WAAW,EAAE,KADK;AAElBC,UAAAA,WAAW,EAAEqC;AAFK,SAApB;;AAIA,QAAA,MAAI,CAACpF,IAAL,CAAUqF,IAAV,CAAeD,GAAG,CAACE,OAAnB,EAA4B,OAA5B;AACD,OA7BI,CAAP;AA8BD,KApCD;AAqCD;AAED;AACF;AACA;AA5LA;;AAAA,SA6LEC,wBA7LF,GA6LE,oCAA4B;AAC1B,QAAMb,OAAO,GAAG,EAAhB,CAD0B,CAG1B;AACA;AACA;;AACA,QAAIc,aAAa,CAACC,eAAlB,EAAmC;AAAA,UACzBC,YADyB,GACR,KAAK1F,IAAL,CAAUP,IADF,CACzBiG,YADyB;AAEjC,UAAIC,uBAAuB,GAAG,EAA9B;;AACA,UAAI,KAAKlG,IAAL,CAAUoC,sBAAd,EAAsC;AACpC8D,QAAAA,uBAAuB,GAAG,CAAC,KAAKlG,IAAL,CAAUoC,sBAAX,CAA1B;AACD,OAFD,MAEO,IAAI6D,YAAY,CAACE,gBAAjB,EAAmC;AACxCD,QAAAA,uBAAuB,GAAGD,YAAY,CAACE,gBAAb,CAA8BC,GAA9B,CAAkCjH,UAAlC,EAA8CkH,MAA9C,CAAqD/G,eAArD,CAA1B;AACD;;AAED,UAAMgH,mBAAmB,GAAGJ,uBAAuB,CAACG,MAAxB,CAA+B,UAACE,aAAD;AAAA,eACzDR,aAAa,CAACC,eAAd,CAA8BO,aAA9B,KACE3H,oBAAoB,CAAC2H,aAAD,CAFmC;AAAA,OAA/B,CAA5B;;AAGA,UAAID,mBAAmB,CAACE,MAApB,GAA6B,CAAjC,EAAoC;AAClCvB,QAAAA,OAAO,CAAC1F,QAAR,GAAmB+G,mBAAmB,CAAC,CAAD,CAAtC;AACD;AACF;;AAED,WAAOrB,OAAP;AACD,GArNH;;AAAA,SAuNEnC,eAvNF,GAuNE,2BAAmB;AAAA;;AACjB;AACA;AACA,SAAK2D,QAAL,GAAgB,IAAIV,aAAJ,CAAkB,KAAKX,MAAvB,EAA+B,KAAKU,wBAAL,EAA/B,CAAhB;AACA,SAAKY,eAAL,GAAuB,EAAvB;AACA,QAAIC,wBAAwB,GAAG,KAA/B;AACA,SAAKF,QAAL,CAAcG,gBAAd,CAA+B,eAA/B,EAAgD,UAACC,KAAD,EAAW;AACzD,MAAA,MAAI,CAACH,eAAL,CAAqBI,IAArB,CAA0BD,KAAK,CAACE,IAAhC;;AADyD,UAGjDd,YAHiD,GAGhC,MAAI,CAAC1F,IAAL,CAAUP,IAHsB,CAGjDiG,YAHiD;;AAIzD,UAAI,MAAI,CAACS,eAAL,CAAqBF,MAArB,GAA8B,CAA9B,IACAP,YAAY,CAACe,WAAb,IAA4B,IAD5B,IAEA,CAACL,wBAFL,EAE+B;AAC7B,YAAMM,SAAS,GAAG,MAAI,CAACP,eAAL,CAAqBQ,MAArB,CAA4B,UAACC,GAAD,EAAMC,KAAN;AAAA,iBAAgBD,GAAG,GAAGC,KAAK,CAACC,IAA5B;AAAA,SAA5B,EAA8D,CAA9D,CAAlB,CAD6B,CAE7B;;;AACA,YAAMC,gBAAgB,GAAG,CAACL,SAAS,GAAG,MAAI,CAACP,eAAL,CAAqB,CAArB,EAAwBW,IAArC,KAA8C,MAAI,CAACX,eAAL,CAAqBF,MAArB,GAA8B,CAA5E,CAAzB;AACA,YAAMe,oBAAoB,GAAGD,gBAAgB,GAAG,CAAhD;AACA,YAAME,OAAO,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYzB,YAAY,CAACe,WAAb,GAA2BO,oBAAvC,CAAhB;;AAEA,YAAIN,SAAS,GAAGO,OAAhB,EAAyB;AACvBb,UAAAA,wBAAwB,GAAG,IAA3B;;AACA,UAAA,MAAI,CAACpG,IAAL,CAAUqF,IAAV,CAAe,MAAI,CAAC7B,IAAL,CAAU,yBAAV,CAAf,EAAqD,SAArD,EAAgE,IAAhE;;AACA,UAAA,MAAI,CAAChB,cAAL;AACD;AACF;AACF,KAnBD,EANiB,CA2BjB;AACA;;AACA,SAAK0D,QAAL,CAAckB,KAAd,CAAoB,GAApB;;AAEA,QAAI,KAAK3H,IAAL,CAAUqC,mBAAd,EAAmC;AACjC;AACA,WAAKuF,oBAAL,GAA4BC,WAAW,CAAC,YAAM;AAC5C,YAAMC,sBAAsB,GAAG,MAAI,CAACC,cAAL,GAAsBxE,sBAArD;;AACA,QAAA,MAAI,CAACd,cAAL,CAAoB;AAAEc,UAAAA,sBAAsB,EAAEuE,sBAAsB,GAAG;AAAnD,SAApB;AACD,OAHsC,EAGpC,IAHoC,CAAvC;AAID;;AAED,SAAKrF,cAAL,CAAoB;AAClBuF,MAAAA,WAAW,EAAE;AADK,KAApB;AAGD,GAjQH;;AAAA,SAmQEjF,cAnQF,GAmQE,0BAAkB;AAAA;;AAChB,QAAMkF,OAAO,GAAG,IAAIhI,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,MAAA,MAAI,CAACsG,QAAL,CAAcG,gBAAd,CAA+B,MAA/B,EAAuC,YAAM;AAC3C1G,QAAAA,OAAO;AACR,OAFD;;AAGA,MAAA,MAAI,CAACuG,QAAL,CAAcyB,IAAd;;AAEA,UAAI,MAAI,CAAClI,IAAL,CAAUqC,mBAAd,EAAmC;AACjC;AACA8F,QAAAA,aAAa,CAAC,MAAI,CAACP,oBAAN,CAAb;;AACA,QAAA,MAAI,CAACnF,cAAL,CAAoB;AAAEc,UAAAA,sBAAsB,EAAE;AAA1B,SAApB;AACD;AACF,KAXe,CAAhB;AAaA,WAAO0E,OAAO,CAAC5D,IAAR,CAAa,YAAM;AACxB,MAAA,MAAI,CAAC5B,cAAL,CAAoB;AAClBuF,QAAAA,WAAW,EAAE;AADK,OAApB;;AAGA,aAAO,MAAI,CAACI,QAAL,EAAP;AACD,KALM,EAKJ/D,IALI,CAKC,UAACgE,IAAD,EAAU;AAChB,UAAI;AACF,QAAA,MAAI,CAAC9H,IAAL,CAAU+H,OAAV,CAAkBD,IAAlB;AACD,OAFD,CAEE,OAAO1C,GAAP,EAAY;AACZ;AACA,YAAI,CAACA,GAAG,CAAC4C,aAAT,EAAwB;AACtB,UAAA,MAAI,CAAChI,IAAL,CAAUiI,GAAV,CAAc7C,GAAd;AACD;AACF;AACF,KAdM,EAcJtB,IAdI,CAcC,YAAM;AACZ,MAAA,MAAI,CAACqC,eAAL,GAAuB,IAAvB;AACA,MAAA,MAAI,CAACD,QAAL,GAAgB,IAAhB;AACD,KAjBM,EAiBJ,UAACgC,KAAD,EAAW;AACZ,MAAA,MAAI,CAAC/B,eAAL,GAAuB,IAAvB;AACA,MAAA,MAAI,CAACD,QAAL,GAAgB,IAAhB;AACA,YAAMgC,KAAN;AACD,KArBM,CAAP;AAsBD,GAvSH;;AAAA,SAySE7F,KAzSF,GAySE,iBAAS;AACP,QAAI,KAAKwC,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYsD,cAAZ,GAA6BnD,OAA7B,CAAqC,UAACoD,KAAD,EAAW;AAC9CA,QAAAA,KAAK,CAACT,IAAN;AACD,OAFD;AAGA,WAAK9C,MAAL,CAAYC,cAAZ,GAA6BE,OAA7B,CAAqC,UAACoD,KAAD,EAAW;AAC9CA,QAAAA,KAAK,CAACT,IAAN;AACD,OAFD;AAGD;;AACD,SAAK/E,YAAL,GAAoB,KAApB;AACA,SAAKiC,MAAL,GAAc,IAAd;AACD,GApTH;;AAAA,SAsTEwD,gBAtTF,GAsTE,4BAAoB;AAClB,WAAO,KAAKC,EAAL,CAAQC,aAAR,CAAsB,oBAAtB,CAAP;AACD,GAxTH;;AAAA,SA0TE9F,iBA1TF,GA0TE,6BAAqB;AAAA;;AACnB,WAAO,IAAI/C,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,UAAI4I,KAAK,GAAG,MAAI,CAAC/I,IAAL,CAAU8B,SAAtB;AAEA,UAAMkH,SAAS,GAAGnB,WAAW,CAAC,YAAM;AAClC,YAAI,CAAC,MAAI,CAAC1E,YAAV,EAAwB;AACtBgF,UAAAA,aAAa,CAACa,SAAD,CAAb;AACA,UAAA,MAAI,CAACC,iBAAL,GAAyB,KAAzB;AACA,iBAAO9I,MAAM,CAAC,IAAI+E,KAAJ,CAAU,sBAAV,CAAD,CAAb;AACD;;AAED,YAAI6D,KAAK,GAAG,CAAZ,EAAe;AACb,UAAA,MAAI,CAACxI,IAAL,CAAUqF,IAAV,CAAkBmD,KAAlB,UAA8B,SAA9B,EAAyC,GAAzC;;AACAA,UAAAA,KAAK;AACN,SAHD,MAGO;AACLZ,UAAAA,aAAa,CAACa,SAAD,CAAb;;AACA,UAAA,MAAI,CAACzI,IAAL,CAAUqF,IAAV,CAAe,MAAI,CAAC7B,IAAL,CAAU,OAAV,CAAf,EAAmC,SAAnC,EAA8C,IAA9C;;AACAmF,UAAAA,UAAU,CAAC;AAAA,mBAAMhJ,OAAO,EAAb;AAAA,WAAD,EAAkB,IAAlB,CAAV;AACD;AACF,OAf4B,EAe1B,IAf0B,CAA7B;AAgBD,KAnBM,CAAP;AAoBD,GA/UH;;AAAA,SAiVE2C,aAjVF,GAiVE,yBAAiB;AAAA;;AACf,QAAI,KAAKoG,iBAAT,EAA4B;AAC5B,SAAKA,iBAAL,GAAyB,IAAzB;AAEA,SAAKjJ,IAAL,CAAU6B,gBAAV,GAA6B6D,KAA7B,CAAmC,UAACC,GAAD,EAAS;AAC1C,UAAME,OAAO,GAAG,OAAOF,GAAP,KAAe,QAAf,GAA0BA,GAAG,CAACE,OAA9B,GAAwCF,GAAxD;;AACA,MAAA,MAAI,CAACpF,IAAL,CAAUqF,IAAV,CAAeC,OAAf,EAAwB,OAAxB,EAAiC,IAAjC;;AACA,aAAO5F,OAAO,CAACE,MAAR,CAAe,IAAI+E,KAAJ,wBAA+BW,OAA/B,CAAf,CAAP;AACD,KAJD,EAIGxB,IAJH,CAIQ,YAAM;AACZ,aAAO,MAAI,CAAC8E,SAAL,EAAP;AACD,KAND,EAMG9E,IANH,CAMQ,UAAC+E,OAAD,EAAa;AACnB,MAAA,MAAI,CAACH,iBAAL,GAAyB,KAAzB;;AACA,UAAI;AACF,QAAA,MAAI,CAAC1I,IAAL,CAAU+H,OAAV,CAAkBc,OAAlB;AACD,OAFD,CAEE,OAAOzD,GAAP,EAAY;AACZ;AACA,YAAI,CAACA,GAAG,CAAC4C,aAAT,EAAwB;AACtB,UAAA,MAAI,CAAChI,IAAL,CAAUiI,GAAV,CAAc7C,GAAd;AACD;AACF;AACF,KAhBD,EAgBG,UAAC8C,KAAD,EAAW;AACZ,MAAA,MAAI,CAACQ,iBAAL,GAAyB,KAAzB;AACA,YAAMR,KAAN;AACD,KAnBD;AAoBD,GAzWH;;AAAA,SA2WEU,SA3WF,GA2WE,qBAAa;AAAA;;AACX,QAAMnE,KAAK,GAAG,KAAK4D,gBAAL,EAAd;;AACA,QAAI,CAAC5D,KAAL,EAAY;AACV,aAAO/E,OAAO,CAACE,MAAR,CAAe,IAAI+E,KAAJ,CAAU,oEAAV,CAAf,CAAP;AACD;;AAED,QAAMmE,KAAK,GAAGrE,KAAK,CAACsE,UAApB;AACA,QAAMC,MAAM,GAAGvE,KAAK,CAACwE,WAArB;AAEA,QAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;AACAF,IAAAA,MAAM,CAACJ,KAAP,GAAeA,KAAf;AACAI,IAAAA,MAAM,CAACF,MAAP,GAAgBA,MAAhB;AACA,QAAMK,GAAG,GAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAZ;AACAD,IAAAA,GAAG,CAACE,SAAJ,CAAc9E,KAAd,EAAqB,CAArB,EAAwB,CAAxB;AAbW,QAeHiB,YAfG,GAec,KAAK1F,IAAL,CAAUP,IAfxB,CAeHiG,YAfG;AAgBX,QAAI8D,uBAAuB,GAAG,EAA9B;;AACA,QAAI,KAAK/J,IAAL,CAAUmC,sBAAd,EAAsC;AACpC4H,MAAAA,uBAAuB,GAAG,CAAC,KAAK/J,IAAL,CAAUmC,sBAAX,CAA1B;AACD,KAFD,MAEO,IAAI8D,YAAY,CAACE,gBAAjB,EAAmC;AACxC4D,MAAAA,uBAAuB,GAAG9D,YAAY,CAACE,gBAAb,CAA8BC,GAA9B,CAAkCjH,UAAlC,EAA8CkH,MAA9C,CAAqD5G,eAArD,CAA1B;AACD;;AAED,QAAMF,QAAQ,GAAGwK,uBAAuB,CAAC,CAAD,CAAvB,IAA8B,YAA/C;AACA,QAAMC,GAAG,GAAGpL,oBAAoB,CAACW,QAAD,CAApB,IAAkC,KAA9C;AACA,QAAM0K,IAAI,YAAUC,IAAI,CAACC,GAAL,EAAV,SAAwBH,GAAlC;AAEA,WAAOlL,YAAY,CAAC2K,MAAD,EAASlK,QAAT,CAAZ,CAA+B8E,IAA/B,CAAoC,UAAC+F,IAAD,EAAU;AACnD,aAAO;AACLC,QAAAA,MAAM,EAAE,MAAI,CAACzJ,EADR;AAELqJ,QAAAA,IAAI,EAAEA,IAFD;AAGLlD,QAAAA,IAAI,EAAE,IAAIuD,IAAJ,CAAS,CAACF,IAAD,CAAT,EAAiB;AAAEtJ,UAAAA,IAAI,EAAEvB;AAAR,SAAjB,CAHD;AAILuB,QAAAA,IAAI,EAAEvB;AAJD,OAAP;AAMD,KAPM,CAAP;AAQD,GA9YH;;AAAA,SAgZE6I,QAhZF,GAgZE,oBAAY;AACV,QAAM7I,QAAQ,GAAG,KAAKmH,eAAL,CAAqB,CAArB,EAAwB5F,IAAzC;AACA,QAAMyJ,aAAa,GAAG3L,oBAAoB,CAACW,QAAD,CAA1C;;AAEA,QAAI,CAACgL,aAAL,EAAoB;AAClB,aAAOtK,OAAO,CAACE,MAAR,CAAe,IAAI+E,KAAJ,6DAAmE3F,QAAnE,QAAf,CAAP;AACD;;AAED,QAAM0K,IAAI,eAAaC,IAAI,CAACC,GAAL,EAAb,SAA2BI,aAArC;AACA,QAAMH,IAAI,GAAG,IAAIE,IAAJ,CAAS,KAAK5D,eAAd,EAA+B;AAAE5F,MAAAA,IAAI,EAAEvB;AAAR,KAA/B,CAAb;AACA,QAAM8I,IAAI,GAAG;AACXgC,MAAAA,MAAM,EAAE,KAAKzJ,EADF;AAEXqJ,MAAAA,IAAI,EAAEA,IAFK;AAGXlD,MAAAA,IAAI,EAAE,IAAIuD,IAAJ,CAAS,CAACF,IAAD,CAAT,EAAiB;AAAEtJ,QAAAA,IAAI,EAAEvB;AAAR,OAAjB,CAHK;AAIXuB,MAAAA,IAAI,EAAEvB;AAJK,KAAb;AAOA,WAAOU,OAAO,CAACC,OAAR,CAAgBmI,IAAhB,CAAP;AACD,GAlaH;;AAAA,SAoaEpF,MApaF,GAoaE,kBAAU;AAAA;;AACR,QAAI,CAAC,KAAKjD,IAAL,CAAU8B,SAAf,EAA0B;AAC1BoH,IAAAA,UAAU,CAAC,YAAM;AACf,MAAA,MAAI,CAAC3I,IAAL,CAAUqF,IAAV,CAAe,MAAI,CAAC7B,IAAL,CAAU,OAAV,CAAf,EAAmC,SAAnC,EAA8C,IAA9C;AACD,KAFS,EAEP,IAFO,CAAV;AAGD,GAzaH;;AAAA,SA2aEb,kBA3aF,GA2aE,4BAAoByB,QAApB,EAA8B;AAC5B,SAAK/B,KAAL;;AACA,SAAKD,MAAL,CAAY;AAAEgC,MAAAA,QAAQ,EAAEA;AAAZ,KAAZ;AACD,GA9aH;;AAAA,SAgbEc,kBAhbF,GAgbE,8BAAsB;AAAA;;AACpB,SAAK7F,YAAL,CAAkBwE,gBAAlB,GAAqCC,IAArC,CAA0C,UAAAC,OAAO,EAAI;AACnD,MAAA,MAAI,CAAC7B,cAAL,CAAoB;AAClBe,QAAAA,YAAY,EAAEc,OAAO,CAAC+B,MAAR,CAAe,UAAC7B,MAAD;AAAA,iBAAYA,MAAM,CAACC,IAAP,KAAgB,YAA5B;AAAA,SAAf;AADI,OAApB;AAGD,KAJD;AAKD,GAtbH;;AAAA,SAwbE/B,MAxbF,GAwbE,kBAAU;AACR,QAAI,CAAC,KAAKS,YAAV,EAAwB;AACtB,WAAKR,MAAL;AACD;;AAED,QAAM6H,WAAW,GAAG,KAAKzC,cAAL,EAApB;;AAEA,QAAI,CAACyC,WAAW,CAACnH,WAAb,IAA4B,CAACmH,WAAW,CAACpH,SAA7C,EAAwD;AACtD,aACE,EAAC,iBAAD;AACE,QAAA,IAAI,EAAEpE,UADR;AAEE,QAAA,IAAI,EAAE,KAAK+E,IAFb;AAGE,QAAA,SAAS,EAAEyG,WAAW,CAACpH;AAHzB,QADF;AAOD;;AAED,WACE,EAAC,YAAD,eACMoH,WADN;AAEE,MAAA,mBAAmB,EAAE,KAAKtH,kBAF5B;AAGE,MAAA,UAAU,EAAE,KAAKL,aAHnB;AAIE,MAAA,gBAAgB,EAAE,KAAKC,eAJzB;AAKE,MAAA,eAAe,EAAE,KAAKC,cALxB;AAME,MAAA,OAAO,EAAE,KAAKE,MANhB;AAOE,MAAA,MAAM,EAAE,KAAKL,KAPf;AAQE,MAAA,IAAI,EAAE,KAAKmB,IARb;AASE,MAAA,KAAK,EAAE,KAAK/D,IAAL,CAAU+B,KATnB;AAUE,MAAA,mBAAmB,EAAE,KAAK/B,IAAL,CAAUqC,mBAVjC;AAWE,MAAA,uBAAuB,EAAE,KAAKrC,IAAL,CAAUiC,uBAXrC;AAYE,MAAA,iBAAiB,EAAElD,qBAAqB,EAZ1C;AAaE,MAAA,SAAS,EAAEyL,WAAW,CAACxC,WAbzB;AAcE,MAAA,MAAM,EAAE,KAAKhI,IAAL,CAAUgC,MAdpB;AAeE,MAAA,GAAG,EAAE,KAAKoD;AAfZ,OADF;AAmBD,GA5dH;;AAAA,SA8dE7C,OA9dF,GA8dE,mBAAW;AAAA;;AACT,SAAKE,cAAL,CAAoB;AAClBY,MAAAA,WAAW,EAAE,KADK;AAElBE,MAAAA,sBAAsB,EAAE;AAFN,KAApB;AAKA,QAAMkH,MAAM,GAAG,KAAKzK,IAAL,CAAUyK,MAAzB;;AACA,QAAIA,MAAJ,EAAY;AACV,WAAKC,KAAL,CAAWD,MAAX,EAAmB,IAAnB;AACD;;AAED,QAAI,KAAK7K,YAAT,EAAuB;AACrB,WAAK6F,kBAAL;;AAEA,WAAK7F,YAAL,CAAkB+K,cAAlB,GAAmC,UAAC9D,KAAD,EAAW;AAC5C,QAAA,OAAI,CAACpB,kBAAL;;AAEA,YAAI,OAAI,CAACL,MAAT,EAAiB;AACf,cAAIwF,aAAa,GAAG,IAApB;;AADe,sCAG2B,OAAI,CAAC7C,cAAL,EAH3B;AAAA,cAGPvE,YAHO,yBAGPA,YAHO;AAAA,cAGOC,eAHP,yBAGOA,eAHP;;AAKfD,UAAAA,YAAY,CAAC+B,OAAb,CAAqB,UAACsF,WAAD,EAAiB;AACpC,gBAAIpH,eAAe,KAAKoH,WAAW,CAAClG,QAApC,EAA8C;AAC5CiG,cAAAA,aAAa,GAAG,KAAhB;AACD;AACF,WAJD;;AAMA,cAAIA,aAAJ,EAAmB;AACjB,YAAA,OAAI,CAAChI,KAAL;;AACA,YAAA,OAAI,CAACD,MAAL;AACD;AACF;AACF,OAnBD;AAoBD;AACF,GAjgBH;;AAAA,SAmgBEmI,SAngBF,GAmgBE,qBAAa;AACX,QAAI,KAAK1F,MAAT,EAAiB;AACf,WAAKxC,KAAL;AACD;;AAED,SAAKmI,OAAL;AACD,GAzgBH;;AAAA;AAAA,EAAsCrM,MAAtC,UACSsM,OADT","sourcesContent":["const { h } = require('preact')\nconst { Plugin } = require('@uppy/core')\nconst Translator = require('@uppy/utils/lib/Translator')\nconst getFileTypeExtension = require('@uppy/utils/lib/getFileTypeExtension')\nconst mimeTypes = require('@uppy/utils/lib/mimeTypes')\nconst canvasToBlob = require('@uppy/utils/lib/canvasToBlob')\nconst supportsMediaRecorder = require('./supportsMediaRecorder')\nconst CameraIcon = require('./CameraIcon')\nconst CameraScreen = require('./CameraScreen')\nconst PermissionsScreen = require('./PermissionsScreen')\n\n/**\n * Normalize a MIME type or file extension into a MIME type.\n *\n * @param {string} fileType - MIME type or a file extension prefixed with `.`.\n * @returns {string|undefined} The MIME type or `undefined` if the fileType is an extension and is not known.\n */\nfunction toMimeType (fileType) {\n  if (fileType[0] === '.') {\n    return mimeTypes[fileType.slice(1)]\n  }\n  return fileType\n}\n\n/**\n * Is this MIME type a video?\n *\n * @param {string} mimeType - MIME type.\n * @returns {boolean}\n */\nfunction isVideoMimeType (mimeType) {\n  return /^video\\/[^*]+$/.test(mimeType)\n}\n\n/**\n * Is this MIME type an image?\n *\n * @param {string} mimeType - MIME type.\n * @returns {boolean}\n */\nfunction isImageMimeType (mimeType) {\n  return /^image\\/[^*]+$/.test(mimeType)\n}\n\n/**\n * Setup getUserMedia, with polyfill for older browsers\n * Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n */\nfunction getMediaDevices () {\n  // eslint-disable-next-line compat/compat\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // eslint-disable-next-line compat/compat\n    return navigator.mediaDevices\n  }\n\n  const getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia\n  if (!getUserMedia) {\n    return null\n  }\n\n  return {\n    getUserMedia (opts) {\n      return new Promise((resolve, reject) => {\n        getUserMedia.call(navigator, opts, resolve, reject)\n      })\n    }\n  }\n}\n/**\n * Webcam\n */\nmodule.exports = class Webcam extends Plugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.mediaDevices = getMediaDevices()\n    this.supportsUserMedia = !!this.mediaDevices\n    this.protocol = location.protocol.match(/https/i) ? 'https' : 'http'\n    this.id = this.opts.id || 'Webcam'\n    this.title = this.opts.title || 'Camera'\n    this.type = 'acquirer'\n    this.icon = () => (\n      <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n        <g fill=\"none\" fill-rule=\"evenodd\">\n          <rect fill=\"#03BFEF\" width=\"32\" height=\"32\" rx=\"16\" />\n          <path d=\"M22 11c1.133 0 2 .867 2 2v7.333c0 1.134-.867 2-2 2H10c-1.133 0-2-.866-2-2V13c0-1.133.867-2 2-2h2.333l1.134-1.733C13.6 9.133 13.8 9 14 9h4c.2 0 .4.133.533.267L19.667 11H22zm-6 1.533a3.764 3.764 0 0 0-3.8 3.8c0 2.129 1.672 3.801 3.8 3.801s3.8-1.672 3.8-3.8c0-2.13-1.672-3.801-3.8-3.801zm0 6.261c-1.395 0-2.46-1.066-2.46-2.46 0-1.395 1.065-2.461 2.46-2.461s2.46 1.066 2.46 2.46c0 1.395-1.065 2.461-2.46 2.461z\" fill=\"#FFF\" fill-rule=\"nonzero\" />\n        </g>\n      </svg>\n    )\n\n    this.defaultLocale = {\n      strings: {\n        smile: 'Smile!',\n        takePicture: 'Take a picture',\n        startRecording: 'Begin video recording',\n        stopRecording: 'Stop video recording',\n        allowAccessTitle: 'Please allow access to your camera',\n        allowAccessDescription: 'In order to take pictures or record video with your camera, please allow camera access for this site.',\n        noCameraTitle: 'Camera Not Available',\n        noCameraDescription: 'In order to take pictures or record video, please connect a camera device',\n        recordingStoppedMaxSize: 'Recording stopped because the file size is about to exceed the limit',\n        recordingLength: 'Recording length %{recording_length}'\n      }\n    }\n\n    // set default options\n    const defaultOptions = {\n      onBeforeSnapshot: () => Promise.resolve(),\n      countdown: false,\n      modes: [\n        'video-audio',\n        'video-only',\n        'audio-only',\n        'picture'\n      ],\n      mirror: true,\n      showVideoSourceDropdown: false,\n      facingMode: 'user',\n      preferredImageMimeType: null,\n      preferredVideoMimeType: null,\n      showRecordingLength: false\n    }\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.install = this.install.bind(this)\n    this.setPluginState = this.setPluginState.bind(this)\n\n    this.render = this.render.bind(this)\n\n    // Camera controls\n    this._start = this._start.bind(this)\n    this._stop = this._stop.bind(this)\n    this._takeSnapshot = this._takeSnapshot.bind(this)\n    this._startRecording = this._startRecording.bind(this)\n    this._stopRecording = this._stopRecording.bind(this)\n    this._oneTwoThreeSmile = this._oneTwoThreeSmile.bind(this)\n    this._focus = this._focus.bind(this)\n    this._changeVideoSource = this._changeVideoSource.bind(this)\n\n    this.webcamActive = false\n\n    if (this.opts.countdown) {\n      this.opts.onBeforeSnapshot = this._oneTwoThreeSmile\n    }\n\n    this.setPluginState({\n      hasCamera: false,\n      cameraReady: false,\n      cameraError: null,\n      recordingLengthSeconds: 0,\n      videoSources: [],\n      currentDeviceId: null\n    })\n  }\n\n  setOptions (newOpts) {\n    super.setOptions({\n      ...newOpts,\n      videoConstraints: {\n        // May be undefined but ... handles that\n        ...this.opts.videoConstraints,\n        ...newOpts?.videoConstraints\n      }\n    })\n\n    this.i18nInit()\n  }\n\n  i18nInit () {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale])\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n    this.setPluginState() // so that UI re-renders and we see the updated locale\n  }\n\n  hasCameraCheck () {\n    if (!this.mediaDevices) {\n      return Promise.resolve(false)\n    }\n\n    return this.mediaDevices.enumerateDevices().then(devices => {\n      return devices.some(device => device.kind === 'videoinput')\n    })\n  }\n\n  getConstraints (deviceId = null) {\n    const acceptsAudio = this.opts.modes.indexOf('video-audio') !== -1 ||\n      this.opts.modes.indexOf('audio-only') !== -1\n    const acceptsVideo = this.opts.modes.indexOf('video-audio') !== -1 ||\n      this.opts.modes.indexOf('video-only') !== -1 ||\n      this.opts.modes.indexOf('picture') !== -1\n\n    const videoConstraints = {\n      ...(this.opts.videoConstraints ?? { facingMode: this.opts.facingMode }),\n      // facingMode takes precedence over deviceId, and not needed\n      // when specific device is selected\n      ...(deviceId ? { deviceId, facingMode: null } : {})\n    }\n\n    return {\n      audio: acceptsAudio,\n      video: acceptsVideo ? videoConstraints : false\n    }\n  }\n\n  _start (options = null) {\n    if (!this.supportsUserMedia) {\n      return Promise.reject(new Error('Webcam access not supported'))\n    }\n\n    this.webcamActive = true\n\n    const constraints = this.getConstraints(options && options.deviceId ? options.deviceId : null)\n\n    this.hasCameraCheck().then(hasCamera => {\n      this.setPluginState({\n        hasCamera: hasCamera\n      })\n\n      // ask user for access to their camera\n      return this.mediaDevices.getUserMedia(constraints)\n        .then((stream) => {\n          this.stream = stream\n\n          let currentDeviceId = null\n          if (!options || !options.deviceId) {\n            currentDeviceId = stream.getVideoTracks()[0].getSettings().deviceId\n          } else {\n            stream.getVideoTracks().forEach((videoTrack) => {\n              if (videoTrack.getSettings().deviceId === options.deviceId) {\n                currentDeviceId = videoTrack.getSettings().deviceId\n              }\n            })\n          }\n\n          // Update the sources now, so we can access the names.\n          this.updateVideoSources()\n\n          this.setPluginState({\n            currentDeviceId,\n            cameraReady: true\n          })\n        })\n        .catch((err) => {\n          this.setPluginState({\n            cameraReady: false,\n            cameraError: err\n          })\n          this.uppy.info(err.message, 'error')\n        })\n    })\n  }\n\n  /**\n   * @returns {object}\n   */\n  _getMediaRecorderOptions () {\n    const options = {}\n\n    // Try to use the `opts.preferredVideoMimeType` or one of the `allowedFileTypes` for the recording.\n    // If the browser doesn't support it, we'll fall back to the browser default instead.\n    // Safari doesn't have the `isTypeSupported` API.\n    if (MediaRecorder.isTypeSupported) {\n      const { restrictions } = this.uppy.opts\n      let preferredVideoMimeTypes = []\n      if (this.opts.preferredVideoMimeType) {\n        preferredVideoMimeTypes = [this.opts.preferredVideoMimeType]\n      } else if (restrictions.allowedFileTypes) {\n        preferredVideoMimeTypes = restrictions.allowedFileTypes.map(toMimeType).filter(isVideoMimeType)\n      }\n\n      const acceptableMimeTypes = preferredVideoMimeTypes.filter((candidateType) =>\n        MediaRecorder.isTypeSupported(candidateType) &&\n          getFileTypeExtension(candidateType))\n      if (acceptableMimeTypes.length > 0) {\n        options.mimeType = acceptableMimeTypes[0]\n      }\n    }\n\n    return options\n  }\n\n  _startRecording () {\n    // only used if supportsMediaRecorder() returned true\n    // eslint-disable-next-line compat/compat\n    this.recorder = new MediaRecorder(this.stream, this._getMediaRecorderOptions())\n    this.recordingChunks = []\n    let stoppingBecauseOfMaxSize = false\n    this.recorder.addEventListener('dataavailable', (event) => {\n      this.recordingChunks.push(event.data)\n\n      const { restrictions } = this.uppy.opts\n      if (this.recordingChunks.length > 1 &&\n          restrictions.maxFileSize != null &&\n          !stoppingBecauseOfMaxSize) {\n        const totalSize = this.recordingChunks.reduce((acc, chunk) => acc + chunk.size, 0)\n        // Exclude the initial chunk from the average size calculation because it is likely to be a very small outlier\n        const averageChunkSize = (totalSize - this.recordingChunks[0].size) / (this.recordingChunks.length - 1)\n        const expectedEndChunkSize = averageChunkSize * 3\n        const maxSize = Math.max(0, restrictions.maxFileSize - expectedEndChunkSize)\n\n        if (totalSize > maxSize) {\n          stoppingBecauseOfMaxSize = true\n          this.uppy.info(this.i18n('recordingStoppedMaxSize'), 'warning', 4000)\n          this._stopRecording()\n        }\n      }\n    })\n\n    // use a \"time slice\" of 500ms: ondataavailable will be called each 500ms\n    // smaller time slices mean we can more accurately check the max file size restriction\n    this.recorder.start(500)\n\n    if (this.opts.showRecordingLength) {\n      // Start the recordingLengthTimer if we are showing the recording length.\n      this.recordingLengthTimer = setInterval(() => {\n        const currentRecordingLength = this.getPluginState().recordingLengthSeconds\n        this.setPluginState({ recordingLengthSeconds: currentRecordingLength + 1 })\n      }, 1000)\n    }\n\n    this.setPluginState({\n      isRecording: true\n    })\n  }\n\n  _stopRecording () {\n    const stopped = new Promise((resolve, reject) => {\n      this.recorder.addEventListener('stop', () => {\n        resolve()\n      })\n      this.recorder.stop()\n\n      if (this.opts.showRecordingLength) {\n        // Stop the recordingLengthTimer if we are showing the recording length.\n        clearInterval(this.recordingLengthTimer)\n        this.setPluginState({ recordingLengthSeconds: 0 })\n      }\n    })\n\n    return stopped.then(() => {\n      this.setPluginState({\n        isRecording: false\n      })\n      return this.getVideo()\n    }).then((file) => {\n      try {\n        this.uppy.addFile(file)\n      } catch (err) {\n        // Logging the error, exept restrictions, which is handled in Core\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n      }\n    }).then(() => {\n      this.recordingChunks = null\n      this.recorder = null\n    }, (error) => {\n      this.recordingChunks = null\n      this.recorder = null\n      throw error\n    })\n  }\n\n  _stop () {\n    if (this.stream) {\n      this.stream.getAudioTracks().forEach((track) => {\n        track.stop()\n      })\n      this.stream.getVideoTracks().forEach((track) => {\n        track.stop()\n      })\n    }\n    this.webcamActive = false\n    this.stream = null\n  }\n\n  _getVideoElement () {\n    return this.el.querySelector('.uppy-Webcam-video')\n  }\n\n  _oneTwoThreeSmile () {\n    return new Promise((resolve, reject) => {\n      let count = this.opts.countdown\n\n      const countDown = setInterval(() => {\n        if (!this.webcamActive) {\n          clearInterval(countDown)\n          this.captureInProgress = false\n          return reject(new Error('Webcam is not active'))\n        }\n\n        if (count > 0) {\n          this.uppy.info(`${count}...`, 'warning', 800)\n          count--\n        } else {\n          clearInterval(countDown)\n          this.uppy.info(this.i18n('smile'), 'success', 1500)\n          setTimeout(() => resolve(), 1500)\n        }\n      }, 1000)\n    })\n  }\n\n  _takeSnapshot () {\n    if (this.captureInProgress) return\n    this.captureInProgress = true\n\n    this.opts.onBeforeSnapshot().catch((err) => {\n      const message = typeof err === 'object' ? err.message : err\n      this.uppy.info(message, 'error', 5000)\n      return Promise.reject(new Error(`onBeforeSnapshot: ${message}`))\n    }).then(() => {\n      return this._getImage()\n    }).then((tagFile) => {\n      this.captureInProgress = false\n      try {\n        this.uppy.addFile(tagFile)\n      } catch (err) {\n        // Logging the error, except restrictions, which is handled in Core\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n      }\n    }, (error) => {\n      this.captureInProgress = false\n      throw error\n    })\n  }\n\n  _getImage () {\n    const video = this._getVideoElement()\n    if (!video) {\n      return Promise.reject(new Error('No video element found, likely due to the Webcam tab being closed.'))\n    }\n\n    const width = video.videoWidth\n    const height = video.videoHeight\n\n    const canvas = document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n    const ctx = canvas.getContext('2d')\n    ctx.drawImage(video, 0, 0)\n\n    const { restrictions } = this.uppy.opts\n    let preferredImageMimeTypes = []\n    if (this.opts.preferredImageMimeType) {\n      preferredImageMimeTypes = [this.opts.preferredImageMimeType]\n    } else if (restrictions.allowedFileTypes) {\n      preferredImageMimeTypes = restrictions.allowedFileTypes.map(toMimeType).filter(isImageMimeType)\n    }\n\n    const mimeType = preferredImageMimeTypes[0] || 'image/jpeg'\n    const ext = getFileTypeExtension(mimeType) || 'jpg'\n    const name = `cam-${Date.now()}.${ext}`\n\n    return canvasToBlob(canvas, mimeType).then((blob) => {\n      return {\n        source: this.id,\n        name: name,\n        data: new Blob([blob], { type: mimeType }),\n        type: mimeType\n      }\n    })\n  }\n\n  getVideo () {\n    const mimeType = this.recordingChunks[0].type\n    const fileExtension = getFileTypeExtension(mimeType)\n\n    if (!fileExtension) {\n      return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type \"${mimeType}\"`))\n    }\n\n    const name = `webcam-${Date.now()}.${fileExtension}`\n    const blob = new Blob(this.recordingChunks, { type: mimeType })\n    const file = {\n      source: this.id,\n      name: name,\n      data: new Blob([blob], { type: mimeType }),\n      type: mimeType\n    }\n\n    return Promise.resolve(file)\n  }\n\n  _focus () {\n    if (!this.opts.countdown) return\n    setTimeout(() => {\n      this.uppy.info(this.i18n('smile'), 'success', 1500)\n    }, 1000)\n  }\n\n  _changeVideoSource (deviceId) {\n    this._stop()\n    this._start({ deviceId: deviceId })\n  }\n\n  updateVideoSources () {\n    this.mediaDevices.enumerateDevices().then(devices => {\n      this.setPluginState({\n        videoSources: devices.filter((device) => device.kind === 'videoinput')\n      })\n    })\n  }\n\n  render () {\n    if (!this.webcamActive) {\n      this._start()\n    }\n\n    const webcamState = this.getPluginState()\n\n    if (!webcamState.cameraReady || !webcamState.hasCamera) {\n      return (\n        <PermissionsScreen\n          icon={CameraIcon}\n          i18n={this.i18n}\n          hasCamera={webcamState.hasCamera}\n        />\n      )\n    }\n\n    return (\n      <CameraScreen\n        {...webcamState}\n        onChangeVideoSource={this._changeVideoSource}\n        onSnapshot={this._takeSnapshot}\n        onStartRecording={this._startRecording}\n        onStopRecording={this._stopRecording}\n        onFocus={this._focus}\n        onStop={this._stop}\n        i18n={this.i18n}\n        modes={this.opts.modes}\n        showRecordingLength={this.opts.showRecordingLength}\n        showVideoSourceDropdown={this.opts.showVideoSourceDropdown}\n        supportsRecording={supportsMediaRecorder()}\n        recording={webcamState.isRecording}\n        mirror={this.opts.mirror}\n        src={this.stream}\n      />\n    )\n  }\n\n  install () {\n    this.setPluginState({\n      cameraReady: false,\n      recordingLengthSeconds: 0\n    })\n\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n\n    if (this.mediaDevices) {\n      this.updateVideoSources()\n\n      this.mediaDevices.ondevicechange = (event) => {\n        this.updateVideoSources()\n\n        if (this.stream) {\n          let restartStream = true\n\n          const { videoSources, currentDeviceId } = this.getPluginState()\n\n          videoSources.forEach((videoSource) => {\n            if (currentDeviceId === videoSource.deviceId) {\n              restartStream = false\n            }\n          })\n\n          if (restartStream) {\n            this._stop()\n            this._start()\n          }\n        }\n      }\n    }\n  }\n\n  uninstall () {\n    if (this.stream) {\n      this._stop()\n    }\n\n    this.unmount()\n  }\n}\n"]}